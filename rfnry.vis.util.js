var rfnry = {
    vis: {
        util: (function() {
        
/*! refinery-utility-visualization 2014-06-05 */
function genericPlain(a,b,c){var d=b.width,e=b.height,f=b.globalMax,g="vertical"===b.orientation?!0:!1,h=g?.01*d:.01*e,i=e/a.length-h,j=d3.scale.linear().domain([0,f]).range([0,d]),k=d3.scale.ordinal().domain(a.map(function(a){return a.id})).rangeRoundBands([0,e],0);g&&(i=d/a.length-h,j=d3.scale.ordinal().domain(a.map(function(a){return a.id})).rangeRoundBands([0,d],0),k=d3.scale.linear().domain([0,f]).range([e,0])),d3.select(b.drawTarget).selectAll("rect").data(a).enter().append("rect").attr("class","bar").attr("x",function(a){return g?j(a.id):0}).attr("y",function(a){return k(g?a.value:a.id)}).attr("width",function(a){return g?i:j(a.value)}).attr("height",function(a){return g?e-k(a.value):i}).style("fill",function(a){return b.color(a.id)}).on("mousemove",function(a){c.onMouseMove(a,this,c)}).on("mouseover",function(a){c.onMouseOver(a,this,c)}).on("mouseout",function(a){c.onMouseOut(a,this,c)}).on("click",function(a){c.onClick(a,this,c)})}function genericSVGFormat(a){var b=a.width,c=a.height,d=a.drawTarget,e=a.hLeft||.1,f=a.hMid||.8,g=a.hRight||.1,h=a.vTop||.1,i=a.vMid||.8,j=a.vBot||.1,k=1e-4;(Math.abs(e+f+g-1)>k||Math.abs(h+i+j-1)>k)&&console.err("FormatError: partition percentages exceed or do not add up to 1"),d3.select("#"+d).html("");var l=d3.select("#"+d).append("svg").attr("width",b).attr("height",c),m=b*e,n=b*(e+f),o=c*h,p=c*(h+i),q=l.selectAll(".leftTop").data([1]).enter().append("g").attr("width",b*e).attr("height",c*h).attr("transform","translate(0, 0)"),r=l.selectAll(".leftMid").data([1]).enter().append("g").attr("width",b*e).attr("height",c*i).attr("transform","translate(0, "+o+")"),s=l.selectAll(".leftBot").data([1]).enter().append("g").attr("width",b*e).attr("height",c*j).attr("transform","translate(0, "+p+")"),t=l.selectAll(".midTop").data([1]).enter().append("g").attr("width",b*f).attr("height",c*h).attr("transform","translate("+m+", 0)"),u=l.selectAll(".midMid").data([1]).enter().append("g").attr("width",b*f).attr("height",c*i).attr("transform","translate("+m+", "+o+")"),v=l.selectAll(".midBot").data([1]).enter().append("g").attr("width",b*f).attr("height",c*j).attr("transform","translate("+m+", "+p+")"),w=l.selectAll(".rightTop").data([1]).enter().append("g").attr("width",b*g).attr("height",c*h).attr("transform","translate("+n+", 0)"),x=l.selectAll(".rightMid").data([1]).enter().append("g").attr("width",b*g).attr("height",c*i).attr("transform","translate("+n+", "+o+")"),y=l.selectAll(".rightBot").data([1]).enter().append("g").attr("width",b*g).attr("height",c*j).attr("transform","translate("+n+", "+p+")");return[[q,r,s],[t,u,v],[w,x,y]]}function genericAxis(a){var b=a.orientation,c=a.drawTarget,d=a.scale,e=a.xShift||0,f=a.yShift||0,g=a.tickAmt||5,h=void 0===a.tickSize?6:a.tickSize,i=a.axisClass||"refinery-utility-axis",j=a.blank||!1;j&&(i="refinery-utility-blankaxis");var k=d3.svg.axis().scale(d).orient(b).ticks(g).tickSize(h);d3.select(c).selectAll("axis").data([1]).enter().append("g").attr("class",i).attr("transform","translate("+e+", "+f+")").style("fill","none").style("stroke",j?"none":"black").call(k)}function simplePlain(a,b,c){for(var d="vertical"===b.orientation?!0:!1,e=.1,f=.8,g=.8,h=genericSVGFormat({width:b.width,height:b.height,drawTarget:b.drawTarget}),i=b.width*f,j=b.height*g,k=[],l=0;l<a.items.length;l++)k.push({id:a.items[l],value:a.matrix[l].sum()});var m=k.map(function(a){return a.value}).max(),n=i,o=j;genericPlain(k,{globalMax:m,orientation:b.orientation,width:i,height:j,drawTarget:h[1][1][0][0],color:d3.scale.category10().domain(k.map(function(a){return a.id}))},c),genericAxis({orientation:"bottom",drawTarget:h[1][2][0][0],tickSize:d?0:6,scale:d?d3.scale.ordinal().domain(a.items).rangeRoundBands([0,n],0):d3.scale.linear().domain([0,m]).range([0,n])}),genericAxis({orientation:"left",drawTarget:h[0][1][0][0],tickSize:d?6:0,scale:d?d3.scale.linear().domain([0,m]).range([o,0]):d3.scale.ordinal().domain(a.items.reverse()).rangeRoundBands([o,0],0),xShift:e*b.width})}function group(a,b,c){function d(a){return a.id}var e=0,f="vertical"===b.orientation?!0:!1,g=.8,h=.8,i=genericSVGFormat({width:b.width,height:b.height,drawTarget:b.drawTarget}),j=b.width*g,k=b.height*h,l=a.matrix.map(function(a){return a.max()}).max(),m=[];for(e=0;e<a.items.length;e++){for(var n=[],o=0;o<a.matrix[e].length;o++)n.push({id:a.items[e]+"-"+a.categories[o],value:a.matrix[e][o]});m.push(n)}var p=f?.01*j:.01*k,q=f?j/m.length-p:j,r=f?k:k/m.length-p,s=d3.select(i[1][1][0][0]).selectAll("g").data(m).enter().append("g").attr("width",q).attr("height",r).attr("transform",function(a,b){return f?"translate("+b*(q+p)+", 0)":"translate(0, "+b*(r+p)+")"}),t=[];for(e=0;e<s[0].length;e++)t.push({width:q,height:r,orientation:b.orientation,drawTarget:s[0][e],globalMax:l,color:d3.scale.category10().domain(m[e].map(d))});for(e=0;e<m.length;e++)genericPlain(m[e],t[e],c);genericAxis({orientation:"bottom",drawTarget:i[1][2][0][0],scale:f?d3.scale.ordinal().domain(a.items).rangeRoundBands([0,j],0):d3.scale.linear().domain([0,l]).range([0,q]),xShift:0,yShift:0,tickSize:f?0:6}),genericAxis({orientation:"left",drawTarget:i[0][1][0][0],scale:f?d3.scale.linear().domain([0,l]).range([k,0]):d3.scale.ordinal().domain(a.items.reverse()).rangeRoundBands([k,0],0),xShift:.1*b.width,yShift:0,tickSize:f?6:0})}function layer(a,b,c){function d(){return y[f]}function e(){return y[f]}var f=0,g="vertical"===b.orientation?!0:!1,h=.1,i=.8,j=.1,k=.1,l=.8,m=.1,n=genericSVGFormat({width:b.width,height:b.height,drawTarget:b.drawTarget,hLeft:h,hMid:i,hRight:j,vTop:k,vMid:l,vBot:m}),o=b.width*i,p=g?b.height*l:b.height*l,q=a.matrix.map(function(a){return a.max()}).max(),r=[];for(f=0;f<a.categories.length;f++){for(var s=[],t=0;t<a.matrix.length;t++)s.push({id:a.items[t]+"-"+a.categories[f],value:a.matrix[t][f]});r.push(s)}var u=g?.05*o:.05*p,v=g?o:o/r.length-u,w=g?p/r.length-u:p,x=d3.select(g?n[1][1][0][0]:n[1][1][0][0]).selectAll("g").data(r).enter().append("g").attr("width",v).attr("height",w).attr("transform",function(a,b){return g?"translate(0, "+b*(w+u)+")":"translate("+b*(v+u)+", 0)"}),y=d3.scale.category10().range(),z=[];for(f=0;f<x[0].length;f++)z.push({width:v,height:w,orientation:b.orientation,drawTarget:x[0][f],globalMax:q,color:d});d3.scale.category10().range().slice(0,r.length).reverse();for(f=0;f<r.length;f++)g?(z[f].color=e,genericPlain(r[r.length-1-f],z[f],c)):genericPlain(r[f],z[f],c);var A;if(g)genericAxis({orientation:"bottom",drawTarget:n[1][2][0][0],scale:d3.scale.ordinal().domain(a.items).rangeRoundBands([0,v],0),yShift:-b.height*m*.55,tickSize:0});else for(A=d3.select(n[1][2][0][0]).selectAll("g").data(r).enter().append("g").attr("width",v).attr("height",b.height*m).attr("transform",function(a,b){return"translate("+b*(v+u)+", 0)"}),f=0;f<A[0].length;f++)genericAxis({orientation:"bottom",drawTarget:A[0][f],scale:d3.scale.linear().domain([0,q]).range([0,v])});if(g)for(A=d3.select(n[0][1][0][0]).selectAll("g").data(r).enter().append("g").attr("width",b.width*h).attr("height",w).attr("transform",function(a,b){return"translate(0, "+b*(w+u)+")"}),f=0;f<A[0].length;f++)genericAxis({orientation:"left",drawTarget:A[0][f],scale:d3.scale.linear().domain([0,q]).range([w,0]),xShift:b.width*h,tickAmt:3});else genericAxis({orientation:"left",drawTarget:n[0][1][0][0],scale:d3.scale.ordinal().domain(a.items).rangeRoundBands([0,w],0),xShift:b.width*h,tickSize:0});genericAxis(g?{orientation:"right",drawTarget:n[2][1][0][0],scale:d3.scale.ordinal().domain(a.categories).rangeRoundBands([p,0],0),blank:!0}:{orientation:"bottom",drawTarget:n[1][0][0][0],scale:d3.scale.ordinal().domain(a.categories).rangeRoundBands([0,o],0),blank:!0,xShift:-b.width*h*.2,yShift:b.height*k*.7})}function stack(a,b,c){for(var d="vertical"===b.orientation?!0:!1,e=(a.matrix.map(function(a){return a.max()}).max(),a.matrix.map(function(a){return a.sum()}).max()),f=d3.scale.ordinal().domain(a.categories).range(d3.scale.category10().range()),g=genericSVGFormat({width:b.width,height:b.height,drawTarget:b.drawTarget}),h=.8*b.width,i=.8*b.height,j=[],k=0;k<a.items.length;k++){j.push({}),j[k].item=a.items[k];for(var l=0;l<a.categories.length;l++)j[k][a.categories[l]]=a.matrix[k][l]}j.forEach(d?function(a){var b=0;a.nums=f.domain().map(function(c){return{name:c,y0:b,y1:b+=+a[c]}}),a.total=a.nums[a.nums.length-1].y1}:function(a){var b=0;a.nums=f.domain().map(function(c){return{name:c,x0:b,x1:b+=a[c]}}),a.total=a.nums[a.nums.length-1].x1});var m,n=d?d3.scale.ordinal().domain(j.map(function(a){return a.item})).rangeRoundBands([0,h],.1):d3.scale.linear().domain([0,d3.max(j,function(a){return a.total})]).range([0,h]),o=d?d3.scale.linear().domain([0,d3.max(j,function(a){return a.total})]).range([i,0]):d3.scale.ordinal().domain(j.map(function(a){return a.item})).rangeRoundBands([0,i],.1);d?(m=d3.select(g[1][1][0][0]).selectAll(".item").data(j).enter().append("g").attr("transform",function(a){return"translate("+n(a.item)+", 0)"}),m.selectAll("rect").data(function(a){return a.nums}).enter().append("rect").attr("class","bar").attr("y",function(a){return o(a.y1)}).attr("width",n.rangeBand()).attr("height",function(a){return o(a.y0)-o(a.y1)}).style("fill",function(a){return f(a.name)}).on("mousemove",function(a){c.onMouseMove({id:a.name,value:a.y1-a.y0},this,c)}).on("mouseover",function(a){c.onMouseOver({id:a.name,value:a.y1-a.y0},this,c)}).on("mouseout",function(a){c.onMouseOut({id:a.name,value:a.y1-a.y0},this,c)}).on("click",function(a){c.onClick({id:a.name,value:a.y1-a.y0},this,c)})):(m=d3.select(g[1][1][0][0]).selectAll(".item").data(j).enter().append("g").attr("transform",function(a){return"translate(0, "+o(a.item)+")"}),m.selectAll("rect").data(function(a){return a.nums.reverse()}).enter().append("rect").attr("class","bar").attr("x",function(a){return n(a.x0)}).attr("y",function(a){return o(a.name)}).attr("width",function(a){return n(a.x1)-n(a.x0)}).attr("height",o.rangeBand()).style("fill",function(a){return f(a.name)}).on("mousemove",function(a){c.onMouseMove({id:a.name,value:a.x1-a.x0},this,c)}).on("mouseover",function(a){c.onMouseOver({id:a.name,value:a.x1-a.x0},this,c)}).on("mouseout",function(a){c.onMouseOut({id:a.name,value:a.x1-a.x0},this,c)}).on("click",function(a){c.onClick({id:a.name,value:a.x1-a.x0},this,c)})),genericAxis({orientation:"bottom",drawTarget:g[1][2][0][0],scale:d?d3.scale.ordinal().domain(a.items).rangeRoundBands([0,h],0):d3.scale.linear().domain([0,e]).range([0,h]),tickSize:d?0:6}),genericAxis({orientation:"left",drawTarget:g[0][1][0][0],scale:d?d3.scale.linear().domain([0,e]).range([i,0]):d3.scale.ordinal().domain(a.items).rangeRoundBands([0,i],0),xShift:.1*b.width,tickSize:d?6:0})}function draw(a,b,c){d3.select("#"+b.drawTarget).html("");var d=jQuery.extend(!0,{},c),e=jQuery.extend(!0,{},b),f=jQuery.extend(!0,{},events);"group"===a?group(d,e,f):"layer"===a?layer(d,e,f):"simple"===a?simplePlain(d,e,f):"stack"===a?stack(d,e,f):alert("Invalid chart type"),d3.select("#"+b.drawTarget).selectAll("text").attr("font-family","times new roman").attr("font-size","14px").attr("fill","black").attr("stroke","none")}Array.prototype.max=function(){for(var a=0,b=this.length;b--;)a<this[b]&&(a=this[b]);return a},Array.prototype.sum=function(){for(var a=0,b=this.length;b--;)a+=this[b];return a};var tooltip=d3.select("body").append("div").attr("class","refinery-utility-tooltip").style("opacity",0).style("position","absolute").style("text-align","center").attr("width","100px").style("background-color","#000").style("opacity","0.8").style("color","#fff").style("font-weight","normal").style("font-size","11.9px").style("border-radius","3px").style("padding","1px 4px 1px 4px"),events={onMouseMove:function(a,b,c){c.tooltipFlag&&c.tooltip.html(a.id+"<br>"+a.value).style("opacity",.9).style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")},onMouseOver:function(a,b,c){c.tooltipFlag=!0,d3.select(b.parentNode).selectAll(".bar").attr("opacity",.6),d3.select(b).attr("opacity",1)},onMouseOut:function(a,b,c){c.tooltipFlag=!1,d3.select(b.parentNode).selectAll(".bar").attr("opacity",1),c.tooltip.style("opacity",0)},onClick:function(){console.log("clicky action going on")},tooltip:tooltip,tooltipFlag:!1},util={draw:draw};
            return util;
        })()
    }
}